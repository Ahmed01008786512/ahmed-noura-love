<!DOCTYPE html>
<html>
<head>
  <title>Ahmed & Noura ğŸ’–</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Helvetica:wght@400;600&display=swap');
    body {
      margin:0;
      font-family:'Helvetica', sans-serif;
      height:100vh;
      display:flex;
      flex-direction:column;
      background-color:#0a0a0a;
      color:white;
      position:relative;
    }
    header {
      text-align:center;
      padding:15px;
      font-size:24px;
      font-weight:600;
      color:#ff4da6;
      border-bottom:1px solid #333;
    }
    #messages {
      flex:1;
      overflow-y:auto;
      padding:15px;
      display:flex;
      flex-direction:column;
      gap:8px;
      background: linear-gradient(135deg,#0a0a0a,#1a1a1a);
      position:relative;
      z-index:1;
    }
    .msg {
      padding:10px 15px;
      border-radius:20px;
      max-width:70%;
      word-wrap:break-word;
      box-shadow:0 2px 5px rgba(0,0,0,0.4);
      font-size:15px;
      line-height:1.4;
    }
    .msg.you { background:#ff4da6; color:white; align-self:flex-end; }
    .msg.noura { background:#1f8a4f; color:white; align-self:flex-start; }
    .inputBox {
      display:flex;
      padding:10px;
      background:#111;
      border-top:1px solid #333;
      gap:5px;
    }
    input[type="text"] {
      flex:1;
      padding:10px;
      border-radius:20px;
      border:none;
      background:#222;
      color:white;
    }
    input[type="file"] {
      width:40px;
      height:40px;
      border:none;
      border-radius:15px;
      background:#ff4da6;
      cursor:pointer;
    }
    button {
      padding:10px 15px;
      border:none;
      border-radius:20px;
      background:#ff4da6;
      color:white;
      cursor:pointer;
    }
    #recordBtn { background:#ff4da6; }
    ::-webkit-scrollbar { width:6px; }
    ::-webkit-scrollbar-thumb { background:#ff4da6; border-radius:3px; }

    /* âœ¨ ØªÙˆÙ‡Ø¬ Ø¨Ø­Ø¨Ùƒ ÙŠØ§ Ù†ÙˆØ±Ø§ */
    #glow {
      position:absolute;
      bottom:80px;
      width:100%;
      text-align:center;
      font-size:22px;
      font-weight:bold;
      color:#ff4da6;
      opacity:0;
      text-shadow: 0 0 10px #ff4da6, 0 0 20px #ff4da6, 0 0 30px #ff80b3;
      pointer-events:none;
      transition: opacity 0.6s ease-out;
      z-index:2;
    }
  </style>
</head>
<body>

<script>
const correctPassword = "Ø¨Ø­Ø¨Ùƒ";
const input = prompt("Noura tell me the password:");
if(input !== correctPassword){
  document.body.innerHTML = "<h1 style='text-align:center; margin-top:50vh; color:#ff4da6;'>Access Denied</h1>";
  throw "Wrong password!";
}
</script>

<header>Ahmed & Noura ğŸ’–</header>
<div id="messages"></div>
<div id="glow">ğŸ’– Ø¨Ø­Ø¨Ùƒ ÙŠØ§ Ù†ÙˆØ±Ø§ ğŸ’–</div>

<div class="inputBox">
  <input id="messageInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
  <input type="file" id="fileInput">
  <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
  <button id="recordBtn">ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhuXjM-H9bSymsU01sz27_5prXXTX7rYU",
  authDomain: "ahmed-noura-love.firebaseapp.com",
  databaseURL: "https://ahmed-noura-love-default-rtdb.firebaseio.com",
  projectId: "ahmed-noura-love",
  storageBucket: "ahmed-noura-love.firebasestorage.app",
  messagingSenderId: "791080256640",
  appId: "1:791080256640:web:91d6fcb85c2838a9619265"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

const roomId = "ahmed-noura-private";
const messagesRef = ref(db, "rooms/" + roomId);
const messagesDiv = document.getElementById("messages");
const glow = document.getElementById("glow");

window.sendMessage = async function() {
  const input = document.getElementById("messageInput");
  const fileInput = document.getElementById("fileInput");
  let content = input.value.trim();

  if(fileInput.files.length > 0){
    const file = fileInput.files[0];
    const storageRef = sRef(storage, `rooms/${roomId}/${Date.now()}_${file.name}`);
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);
    content = `<img src="${url}" style="max-width:150px; border-radius:10px;">`;
    fileInput.value = "";
  }

  if(content !== ""){
    push(messagesRef, { text: content, sender: "you" });
    input.value = "";

    // âœ¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙˆÙ‡Ø¬ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    glow.style.opacity = 1;
    setTimeout(()=>{ glow.style.opacity = 0; }, 1200);
  }
}

onChildAdded(messagesRef, (data)=>{
  const msgData = data.val();
  const msg = document.createElement("div");
  msg.className = "msg " + (msgData.sender || "noura");
  msg.innerHTML = msgData.text;
  messagesDiv.appendChild(msg);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

let mediaRecorder;
let audioChunks = [];
const recordBtn = document.getElementById("recordBtn");

recordBtn.onclick = async function() {
  if(recordBtn.innerText === "ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª"){
    const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = async () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      const storageRef = sRef(storage, `rooms/${roomId}/${Date.now()}_voice.webm`);
      await uploadBytes(storageRef, audioBlob);
      const url = await getDownloadURL(storageRef);
      push(messagesRef, { text: `<audio controls src="${url}"></audio>`, sender:"you" });

      glow.style.opacity = 1;
      setTimeout(()=>{ glow.style.opacity = 0; }, 1200);
    };
    mediaRecorder.start();
    recordBtn.innerText = "â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
  } else {
    mediaRecorder.stop();
    recordBtn.innerText = "ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª";
  }
}
</script>

</body>
</html>
